<!doctype html>
<html>

<head>
  <title>Hello, Snaps!</title>
  <link rel="icon" type="image/svg" href="./images/icon.svg" />
</head>

<body>
  <h1>Welcome to QuaiSnap!</h1>
  <details>
    <summary>Instructions</summary>
    <ul>
      <li>First, click "Connect". Then, try out the other buttons!</li>
      <li>Please note that:</li>
      <ul>
        <li>
          The <code>snap.manifest.json</code> and <code>package.json</code> must be located in the server root
          directory..
        </li>
        <li>
          The Snap bundle must be hosted at the location specified by the <code>location</code> field of
          <code>snap.manifest.json</code>.
        </li>
      </ul>
    </ul>
  </details>
  <br />

  <button class="connect">Connect</button>
  <button class="getaccounts">GetAccounts</button>
  <input id="balanceAddress" value="0x...." type="text" />
  <button class="getBalance">Get Balance</button>
  <input id="accountName" placeholder="Account Name" type="text" />
  <button class="createAccount">Create Account</button>
  <button class="clearAccounts">Clear Accounts</button>
  <button class="blockHeight">Block Height</button>
  <input id="SendTo" value="0xD5813D46F74273048D485944DC7DE12FC1947f12" placeholder="reciver address" />
  <input id="Amount" value="100000" placeholder="amount" type="number" />
  <button class="transact">Transact</button>
  <input id="NumAccounts" value="25" placeholder="amount" type="number" />
  <button class="generateNum">Generate N Accounts</button>
  <input id="SignMessage" type="text">
  <button class="messageSigner">Sign Message</button>
  <button class="getTransactions">Get Transactions</button>
  <button class="getAddress">Get Address</button>
  <button class="mnemonic">Mnemonic</button>
  <button class="getAccount">Get Current Account</button>
  <input id="setAddress" value="0x....." type="text">
  <button class="setCurrentAccount" value="Cyprus">Set Current Account</button>
  <button class="genAllAccounts">Generate All Accounts</button>
  <input id="createByChain" value="cyprus-1" type="'text">
  <button class="accountByChain">Create Account by Chain</button>
  <h1>Contracts</h1>
  <input id="contractAddress" placeholder="Contract Address" type="text">
  <input id="byteCode" placeholder="Byte Code" type="text">
  <button class="contractInteraction"> Interact with Contract</button>
  <h1>Tests</h1>
  <p>Read the test descriptions <a
      href="https://www.notion.so/dominantstrategies/6-Functional-Testing-4bb4190044b74e98a4d00a136c410d9f">here.</a>
  </p>
  <button class="test1">Test 1</button>
</body>
<script>
  const snapId = 'local:http://localhost:8080/'//`local:${window.location.href}`;

  const connectButton = document.querySelector('button.connect')
  const sendButton = document.querySelector('button.getaccounts')
  const getBalanceButton = document.querySelector('button.getBalance')
  const createButton = document.querySelector('button.createAccount')
  const clearButton = document.querySelector('button.clearAccounts')
  const blockHeightButton = document.querySelector('button.blockHeight')
  const transactButton = document.querySelector('button.transact')
  const generateNButton = document.querySelector('button.generateNum')
  const messageButton = document.querySelector('button.messageSigner')
  const transactionsButton = document.querySelector('button.getTransactions')
  const addressButton = document.querySelector('button.getAddress')
  const mnemonicButton = document.querySelector('button.mnemonic')
  const getaccountButton = document.querySelector('button.getAccount')
  const setcurrentaccountButton = document.querySelector('button.setCurrentAccount')
  const genAllAccountsButton = document.querySelector('button.genAllAccounts')
  const accountByChainButton = document.querySelector('button.accountByChain')
  //TESTS
  const test1Button = document.querySelector('button.test1')
  const contractButton = document.querySelector('button.contractInteraction')

  connectButton.addEventListener('click', connect)
  sendButton.addEventListener('click', getAccounts)
  getBalanceButton.addEventListener('click', getBalance)
  createButton.addEventListener('click', create)
  clearButton.addEventListener('click', clearAccounts)
  blockHeightButton.addEventListener('click', blockHeight)
  transactButton.addEventListener('click', transact)
  generateNButton.addEventListener('click', generateNumAccounts)
  messageButton.addEventListener('click', sign)
  transactionsButton.addEventListener('click', getTransactions)
  addressButton.addEventListener('click', getAddress)
  mnemonicButton.addEventListener('click', displayMnemonic)
  getaccountButton.addEventListener('click', getAccount)
  setcurrentaccountButton.addEventListener('click', setCurrentAccount)
  genAllAccountsButton.addEventListener('click', genAllAccounts)
  accountByChainButton.addEventListener('click', accountByChain)
  //TESTS
  test1Button.addEventListener('click', test1)
  contractButton.addEventListener('click', contractInteraction)

  async function contractInteraction() {
    try {
      const contractAddress = document.getElementById('contractAddress').value
      const byteCode = document.getElementById('byteCode').value
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'contractInteract',
          params: {
            address: contractAddress,
            data: byteCode
          }
        }]
      })
      alert(JSON.stringify(response))
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //Creates a random 0 - 10 accounts
  async function test1() {
    let total = 0
    try {
      for (i = 0; i < 10; i++) {
        numAccounts = Math.floor(Math.random() * 10 + 1);
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId, {
            method: 'generateNumAccounts',
            amount: numAccounts
          }]
        })
        total += response.Accounts.length
        console.log(response)
        const response2 = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId, {
            method: 'getAccounts',
          }]
        })
        console.log(response2)
        if (response2.length != total) {
          console.log("Test 1 Failed")
          return
        }
      }
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }


  async function accountByChain() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'createAccountByChain',
          params: {
            chain: document.getElementById('createByChain').value
          }
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function genAllAccounts() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'generateAllAccounts',
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //set your current account to be different
  async function setCurrentAccount() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'setCurrentAccount',
          params: {
            address: document.querySelector('#setAddress').value,
          }
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  // here we get permissions to interact with and install the snap
  async function connect() {
    await ethereum.request({
      method: 'wallet_enable',
      params: [{
        wallet_snap: { [snapId]: {} },// version: "0.1.0-pre.30" 
      }]
    })
  }

  // here we call the snap's "hello" method
  async function getAccounts() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getAccounts'
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  // here we call the snap's "hello" method
  async function getBalance() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'displayBalance',
          params: {
            address: document.querySelector('#balanceAddress').value
          }
        }],
      });
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  // here we call the snap's "hello" method
  async function create() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId,
          {
            method: 'createAccount',
            params: {
              name: document.querySelector('#accountName').value //Name can be anything
            }
          }],
      });
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function clearAccounts() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'clearAccounts'
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  // here we call the snap's "hello" method
  async function blockHeight() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getBlockHeight'
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  // generate N number of accounts
  async function generateNumAccounts() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'generateNumAccounts',
          params: {
            amount: document.querySelector('#NumAccounts').value
          }
        }]
      })
      alert(response)
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function transact() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'transfer',
          params: {
            to: document.querySelector('#SendTo').value,
            amount: document.querySelector('#Amount').value
          }
        }]
      })
      alert(response)
      console.log("transaction returned");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function sign() {
    try {
      console.log("Signing message:" + document.querySelector('#SignMessage').value);
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'signData',
          params: {
            data: document.querySelector('#SignMessage').value
          }
        }]
      })
      alert(response);
      console.log("Message successfuly signed");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //Getting user transactions
  async function getTransactions() {
    try {
      console.log("Getting transactions....");
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getTransactions'
        }]
      })
      alert(response);
      console.log("Got Transactions");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //Get and display user address
  async function getAddress() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getAddress'
        }]
      })
      alert(response);
      console.log("Got Address");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //Display mnemonic phrase
  async function displayMnemonic() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'displayMnemonic'
        }]
      })
      alert(response);
      console.log("Got Mnemonic Phrase");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  //GetAccount api call test
  async function getAccount() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getCurrentAccount'
        }]
      })
      alert(response);
      console.log("Got Account");
      console.log(response);
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }
</script>

</html>